//海洋主题的动态装扮 define(function(require, exports, module){    var $ = require('jquery'),        html = [            '<div class="layout-dynamic">',                '<canvas id="dynamic_canvas" ></canvas>',            '</div>'];    var support = "onwheel" in document.createElement("div") ? "wheel" : // Modern browsers support "wheel"              document.onmousewheel !== undefined ? "mousewheel" : // Webkit and IE support at least "mousewheel"              "DOMMouseScroll"; // let's assume that remaining browsers are older Firefox    var browser_wh,browser_center,context;    var interval=100;    var ratio = Math.PI / 180;    var angle=3;    var blobs=[        {color:"62,131,106",angle:90,distance:0.60,scale:2.5,buffer:0},        {color:"180,171,118",angle:135,distance:0.6,scale:1.36,buffer:0},        {color:"195,140,126",angle:180,distance:0.8,scale:0.96,buffer:0},        {color:"215,105,84",angle:225,distance:0.9,scale:1.56,buffer:0},        {color:"213,137,128",angle:270,distance:0.7,scale:1.39,buffer:0},        {color:"175,157,113",angle:315,distance:0.7,scale:1.26,buffer:0}    ];    var theme_dynamic_obj={        init:function(itemno){            //var baseURL = 'http://' + window.iiDomain +"/qzone/space_item/orig/"+itemno % 16+ "/" + itemno + '/';            if($.ua.ie < 10)return;            $(window).resize(theme_dynamic_obj.resize);            var bsWidth=$(window).width();            var bsHeight=$(window).height();            //动画逻辑代码开始            theme_dynamic_obj.resize();            browser_wh={w:$(window).width(),h:$(window).height()};            browser_center={x:browser_wh.w/2,y:browser_wh.h/2};            var canvas = document.getElementById("dynamic_canvas");            $(canvas).attr("width",browser_wh.w);            $(canvas).attr("height",browser_wh.h);            context = canvas.getContext('2d');            theme_dynamic_obj.start();                    },        resize:function(){            browser_wh={w:$(window).width(),h:$(window).height()};            browser_center={x:browser_wh.w/2,y:browser_wh.h/2};            var canvas = document.getElementById("dynamic_canvas");            $(canvas).attr("width",browser_wh.w);            $(canvas).attr("height",browser_wh.h);        },        start:function(){            theme_dynamic_obj.getBuffer();            //console.log(blobs);return;            setInterval(theme_dynamic_obj.update,interval);        },        getBuffer:function(){            $.each(blobs,function(key,blob){                blob.angle+=angle;                if(blob.angle>360)blob.angle-=360;                var x=browser_center.x + browser_wh.w/2*blob.distance*Math.cos( blob.angle * ratio);                var y=browser_center.y - browser_wh.h/2*blob.distance*Math.sin( blob.angle * ratio);                BLOB_OPACITY=1;                var buffer, bufferCanvas, gradient, id;                var scale=blob.scale;                if (scale == null) {                  scale = 1.0;                }                var radius=500;                var bufferCanvas = document.createElement('canvas');                bufferCanvas.width = radius * 2;                bufferCanvas.height = radius * 2;                buffer = bufferCanvas.getContext('2d');                buffer.beginPath();                gradient = buffer.createRadialGradient(radius, radius, 0, radius, radius, radius);                gradient.addColorStop(1.0, "rgba(" + blob.color + ", 0)");                gradient.addColorStop(0, "rgba(" + blob.color + ", " + BLOB_OPACITY + ")");                buffer.fillStyle = gradient;                buffer.arc(radius, radius, radius, Math.PI * 2, false);                buffer.closePath();                buffer.fill();                blob.buffer=bufferCanvas;            })        },        update:function(){            theme_dynamic_obj.clear();            $.each(blobs,function(key,blob){                blob.angle+=angle;                if(blob.angle>360)blob.angle-=360;                var radius=500;                var x=browser_center.x + browser_wh.w/2*blob.distance*Math.cos( blob.angle * ratio);                var y=browser_center.y - browser_wh.h/2*blob.distance*Math.sin( blob.angle * ratio);                radius *= blob.scale;                context.drawImage(blob.buffer, x - radius, y - radius, radius * 2, radius * 2);            })        },        clear:function(){            context.fillStyle = '#fff';            context.fillRect(0, 0, browser_wh.w, browser_wh.h);        },        remove : function(){            //resize            $(window).unbind('resize', theme_dynamic_obj.resize);        }    }        var render = function(itemno){        //插入样式//      $(document.head).append('<link id="dynamicStyle" rev="stylesheet" rel="stylesheet" type="text/css" media="screen" href="http://'+window.siDomain+'/qzone/v8/dress/dynamic/91732/style.css" />');        $('#layBackground').append(html.join(''));        theme_dynamic_obj.init(itemno);        /*移除之前的背景        window.setTimeout(function(){            $('#layBackground').css('background', 'none');        }, 50);        */    };    var remove = function(){        $('.layout-dynamic').remove();        //$('#dynamicStyle').remove();        theme_dynamic_obj.remove();    };    exports.render = render;    exports.remove = remove;});